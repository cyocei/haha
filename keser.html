<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Keser - Advanced Username Search Tool">
    <meta name="keywords" content="username search, social media, account finder">
    <title>Keser - Username Search</title>
    <style>
        :root {
            --primary-color: rgb(255, 20, 147);
            --secondary-color: rgb(173, 216, 230);
            --background-color: #1a1a1a;
            --text-color: #fff;
        }

        body {
            margin: 0;
            padding: 20px;
            background: var(--background-color);
            color: var(--text-color);
            font-family: 'Courier New', monospace;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .banner {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .banner pre {
            color: var(--primary-color);
            margin: 0;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: var(--text-color);
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        button:hover {
            opacity: 0.9;
        }

        .results {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            background: #333;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-item a {
            color: var(--secondary-color);
            text-decoration: none;
        }

        .result-item .category {
            color: #0f0;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            color: var(--secondary-color);
            margin: 20px 0;
            display: none;
        }

        .error {
            color: #ff0000;
            margin: 10px 0;
            display: none;
        }

        .summary {
            margin-top: 20px;
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="banner">
            <pre>
.-. .-..----. .----..----..----. 
| |/ / | {_  { {__  | {_  | {}  }
| |\ \ | {__ .-._} }| {__ | .-. \
`-' `-'`----'`----' `----'`-' `-'
            </pre>
            <div style="color: #800080;">The Advance Username Search.</div>
            <div style="color: #800080;">~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~</div>
        </div>

        <div class="search-container">
            <input type="text" id="username" placeholder="Enter username to search">
            <button onclick="searchUsername()">Search</button>
        </div>

        <div class="loading" id="loading">Searching...</div>
        <div class="error" id="error"></div>
        <div class="results" id="results"></div>
        <div class="summary" id="summary"></div>
    </div>

    <script>
        const USER_AGENTS = [
            "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/37.0.2062.94 Chrome/37.0.2062.94 Safari/537.36",
            "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.85 Safari/537.36",
            "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
            "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0",
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/600.8.9 (KHTML, like Gecko) Version/8.0.8 Safari/600.8.9",
        ];

        const PROXY_SERVICES = [
            (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
            (url) => `https://bypass.duti.tech/url/${encodeURIComponent(url)}`,
            (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
            (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,
            (url) => `https://cors.isteed.cc/proxy/${encodeURIComponent(url)}`,
            (url) => `https://cors-anywhere.herokuapp.com/${url}`
        ];

        const API_URL = 'https://keser-api.onrender.com';

        async function fetchMetadata() {
            try {
                const response = await fetch(`${API_URL}/metadata`);
                if (!response.ok) {
                    throw new Error('Failed to fetch metadata');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching metadata:', error);
                return null;
            }
        }

        function getRandomUserAgent() {
            return USER_AGENTS[Math.floor(Math.random() * USER_AGENTS.length)];
        }

        async function tryProxyRequest(url, proxyIndex = 0) {
            if (proxyIndex >= PROXY_SERVICES.length) {
                return null;
            }

            try {
                const proxyUrl = PROXY_SERVICES[proxyIndex](url);
                const response = await fetch(proxyUrl, {
                    headers: {
                        "User-Agent": getRandomUserAgent(),
                        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
                        "Accept-Language": "en-US,en;q=0.5",
                        "Referer": "https://www.google.com/",
                        "DNT": "1",
                        "Connection": "keep-alive",
                        "Upgrade-Insecure-Requests": "1"
                    },
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error('Response not ok');
                }

                const text = await response.text();
                return {
                    status: response.status,
                    text: text
                };
            } catch (error) {
                // Try next proxy service after a small delay
                await new Promise(resolve => setTimeout(resolve, 100));
                return tryProxyRequest(url, proxyIndex + 1);
            }
        }

        async function checkUsernameOnWebsite(site, username) {
            const url = site.uri_check.replace("{account}", username);
            
            try {
                const response = await fetch(`${API_URL}/check`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        url,
                        e_string: site.e_string,
                        m_string: site.m_string,
                        e_code: site.e_code || 200,
                        m_code: site.m_code || 404
                    })
                });

                const data = await response.json();
                
                // If the request timed out, skip this site
                if (response.status === 408) {
                    console.log(`Timeout checking ${site.name}, skipping...`);
                    return null;
                }

                if (data.exists) {
                    return {
                        name: site.name,
                        url: data.final_url || url,
                        category: site.cat
                    };
                }
                return null;
            } catch (error) {
                console.log(`Error checking ${site.name}:`, error);
                return null;
            }
        }

        function addResultToDOM(result) {
            const results = document.getElementById('results');
            results.style.display = 'block';  // Make sure it's visible

            // Create a simple div with the result
            const div = document.createElement('div');
            div.style.padding = '10px';
            div.style.margin = '5px';
            div.style.backgroundColor = '#333';
            div.innerHTML = `
                <a href="${result.url}" target="_blank" style="color: lightblue;">
                    ${result.name}
                </a>
                <span style="color: lime; margin-left: 10px;">${result.category}</span>
            `;
            
            results.appendChild(div);
        }

        async function searchUsername() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                showError('Please enter a username');
                return;
            }

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            const summary = document.getElementById('summary');

            // Clear previous results
            loading.style.display = 'block';
            results.innerHTML = '';
            results.style.display = 'block';
            error.style.display = 'none';
            summary.innerHTML = '';

            try {
                const metadata = await fetchMetadata();
                if (!metadata || !metadata.sites) {
                    throw new Error('Failed to fetch metadata');
                }

                let foundCount = 0;
                let timeoutCount = 0;
                let errorCount = 0;
                const totalSites = metadata.sites.length;

                // Process sites in smaller batches
                const batchSize = 3;
                for (let i = 0; i < metadata.sites.length; i += batchSize) {
                    const batch = metadata.sites.slice(i, i + batchSize);
                    
                    // Update progress
                    summary.innerHTML = `Checking sites ${i + 1}-${Math.min(i + batchSize, totalSites)} of ${totalSites}...`;
                    
                    // Process batch in parallel
                    const results = await Promise.all(
                        batch.map(site => 
                            checkUsernameOnWebsite(site, username)
                            .then(result => {
                                if (result) {
                                    foundCount++;
                                    addResultToDOM(result);
                                }
                                return result;
                            })
                            .catch(error => {
                                errorCount++;
                                console.error(`Error with ${site.name}:`, error);
                                return null;
                            })
                        )
                    );

                    // Small delay between batches
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                loading.style.display = 'none';
                
                if (foundCount === 0) {
                    showError(`Username '${username}' not found on any sites`);
                }

                // Show final summary
                summary.innerHTML = `Search complete | Found: ${foundCount} matches | Errors: ${errorCount}`;
            } catch (error) {
                loading.style.display = 'none';
                showError('Search completed with some errors');
                console.error('Search error:', error);
            }
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }

        // Handle Enter key press
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchUsername();
            }
        });
    </script>
    
    <!-- Add footer -->
    <footer style="text-align: center; margin-top: 20px; color: #666;">
        <p>Keser Username Search Tool</p>
    </footer>
</body>
</html> 
